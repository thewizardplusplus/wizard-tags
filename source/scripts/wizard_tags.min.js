// The MIT License (MIT)
// Copyright (c) 2015 thewizardplusplus <thewizardplusplus@yandex.ru>
var WizardTags=function(){var n=function(){var e=function(b){return function(c){return b.filter(function(a){return a.substr(0,c.length)==c})}},d=function(b){var c=function(){return[]};b.tags instanceof Function?c=b.tags:b.tags instanceof Array&&(c=e(b.tags));return c};return{process:function(b){b=b||{};b.tags=d(b);b.separators=b.separators||" ";b.onChange=b.onChange||function(){};return b}}}(),m=function(){return{getRoot:function(e){e=document.querySelector(e);e.className="wizard-tags";return e},
makeInner:function(e,d){var b=document.createElement("div");b.className="inner-container";b.addEventListener("click",d.updateAutocompleteList);e.appendChild(b);return b}}}(),p=function(){var e=function(d){d.setAttribute("size",d.value.length+1)};return function(d,b,c){var a=document.createElement("input");a.className="input";e(a);a.addEventListener("focus",function(){c.updateAutocompleteList(this.value)});var g=null;a.addEventListener("keyup",function(a){var d=this.value.slice(-1);if(13==a.which||
d.length&&-1!=b.indexOf(d))c.addTag(13==a.which?this.value:this.value.slice(0,-1)),this.value="",e(this),c.updateAutocompleteList("");else{e(this);clearTimeout(g);var f=this;g=setTimeout(function(){c.updateAutocompleteList(f.value)},300)}});a.addEventListener("blur",function(){setTimeout(function(){c.removeAutocompleteList()},250)});d.appendChild(a);return a}}(),q=function(e,d,b){var c=function(a,b,d){var c=document.createElement("span");c.className="remove-button";c.addEventListener("click",function(){a.removeChild(b);
d.onTagListChange()});return c};this.getTags=function(){for(var a=[],b=e.querySelectorAll(".tag-view"),c=0;c<b.length;c++){var d=b[c].querySelector(".text-view").innerHTML;a.push(d)}return a};this.addTag=function(a,b,d,e){a=a.trim();if(0!=a.length){var f=a;a=document.createElement("span");a.className="tag-view";var k=document.createElement("span");k.className="text-view";k.innerHTML=f;a.appendChild(k);f=c(b,a,e);a.appendChild(f);b.insertBefore(a,d);e.onTagListChange()}}},r=function(e,d,b){var c=function(a){var c=
document.createElement("li");c.innerHTML=a;c.addEventListener("click",function(){b.addTag(a)});return c};this.makeList=function(a){a=e(a);if(a.length){var b=document.createElement("ul");b.className="autocomplete-list";for(var h=0;h<a.length;h++){var l=c(a[h]);b.appendChild(l)}d.appendChild(b);return b}return null};this.removeList=function(a){a&&a.parentNode==d&&d.removeChild(a)};this.updateList=function(a,b){this.removeList(a);return this.makeList(b)}};return function(e,d){d=n.process(d);var b=this,
c=null,a=m.getRoot(e),g=m.makeInner(a,{updateAutocompleteList:function(){f.focus()}}),h={onTagListChange:function(){d.onChange.apply(b)}},l=new q(g,f,h),f=p(g,d.separators,{addTag:function(a){l.addTag(a,g,f,h)},updateAutocompleteList:function(a){c=k.updateList(c,a)},removeAutocompleteList:function(){k.removeList(c);c=null}}),k=new r(d.tags,a,{addTag:function(a){l.addTag(a,g,f,h)}});this.getTags=function(){return l.getTags()}}}();
